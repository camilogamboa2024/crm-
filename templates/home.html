{% load static %}
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gamboa Rental Cars</title>

    <!-- Tailwind (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React 18 UMD -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel (JSX en el navegador; ok para demo/prototipo) -->
    <script crossorigin src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  </head>

  <body class="bg-gray-50 text-gray-900">
    <div id="root"></div>

    <script id="cars-data" type="application/json">{{ cars|safe }}</script>

    <script type="text/babel">
      const carsData = JSON.parse(document.getElementById('cars-data').textContent || '[]');

      function daysBetweenInclusive(startISO, endISO) {
        if (!startISO || !endISO) return 0;
        const s = new Date(startISO + 'T00:00:00');
        const e = new Date(endISO + 'T00:00:00');
        const diff = Math.round((e - s) / (1000 * 60 * 60 * 24));
        return diff >= 0 ? diff + 1 : 0;
      }

      function Navbar() {
        const links = [
          { href: '#vehiculos', label: 'Veh칤culos' },
          { href: '#beneficios', label: 'Beneficios' },
          { href: '#contacto', label: 'Contacto' },
          { href: '/buscar/', label: 'Reservar' },
          { href: '/crm/', label: 'CRM' },
          { href: '/contrato/', label: 'Contrato' },
        ];
        return (
          <header className="bg-white shadow fixed w-full z-20">
            <div className="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
              <a href="/" className="flex items-center gap-2">
                <img src="{% static 'images/logo.png' %}" alt="Logo" className="h-8 w-auto" />
                <span className="font-semibold text-lg text-gray-700 hidden sm:block">Gamboa Rental</span>
              </a>
              <nav className="hidden md:flex gap-6">
                {links.map((l) => (
                  <a key={l.href} href={l.href} className="text-sm font-medium text-gray-600 hover:text-gray-900">
                    {l.label}
                  </a>
                ))}
              </nav>
            </div>
          </header>
        );
      }

      function CarCard({ car, startDate, endDate }) {
        const params = new URLSearchParams({
          pickup: 'Panam치',
          start_date: startDate || '',
          end_date: endDate || '',
          car_id: String(car.id),
        });
        return (
          <div className="bg-white rounded-2xl shadow overflow-hidden">
            <img src={car.image_url} alt={car.name} className="w-full h-40 object-cover" />
            <div className="p-4">
              <div className="font-semibold">{car.name}</div>
              <div className="text-sm text-gray-500">Color: {car.color} 췅 {car.category}</div>
              <div className="mt-2 text-sm">
                <span className="font-semibold">${car.daily_rate}</span> / d칤a
              </div>
              <a
                href={`/buscar/?${params.toString()}`}
                className="mt-3 inline-flex w-full items-center justify-center rounded-xl bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 font-semibold"
              >
                Reservar
              </a>
            </div>
          </div>
        );
      }

      function App() {
        const [pickup, setPickup] = React.useState('Panam치');
        const [startDate, setStartDate] = React.useState('');
        const [endDate, setEndDate] = React.useState('');
        const [msg, setMsg] = React.useState('');

        const quote = () => {
          setMsg('');
          if (!startDate || !endDate) {
            setMsg('Selecciona la fecha de inicio y la fecha de fin.');
            return;
          }
          if (daysBetweenInclusive(startDate, endDate) <= 0) {
            setMsg('La fecha de fin debe ser igual o posterior a la fecha de inicio.');
            return;
          }
          const params = new URLSearchParams({
            pickup: pickup || 'Panam치',
            start_date: startDate,
            end_date: endDate,
          });
          window.location.href = `/buscar/?${params.toString()}`;
        };

        return (
          <div className="min-h-screen">
            <Navbar />

            {/* Hero */}
            <section className="pt-24">
              <div className="max-w-7xl mx-auto px-4">
                <div className="rounded-3xl bg-gradient-to-r from-blue-700 to-teal-600 text-white p-8 md:p-12 shadow">
                  <div className="max-w-3xl">
                    <h1 className="text-3xl md:text-5xl font-extrabold leading-tight">Tu viaje comienza aqu칤</h1>
                    <p className="mt-3 text-white/90">
                      Reserva tu veh칤culo ideal con Gamboa Rental Cars y descubre la libertad de conducir.
                    </p>

                    <div className="mt-6 bg-white/10 backdrop-blur rounded-2xl p-4 md:p-5">
                      <div className="grid grid-cols-1 md:grid-cols-4 gap-3">
                        <input
                          className="rounded-xl px-4 py-3 text-gray-900"
                          value={pickup}
                          onChange={(e) => setPickup(e.target.value)}
                          placeholder="Lugar (Ej. Panam치)"
                        />
                        <input
                          className="rounded-xl px-4 py-3 text-gray-900"
                          type="date"
                          value={startDate}
                          onChange={(e) => setStartDate(e.target.value)}
                        />
                        <input
                          className="rounded-xl px-4 py-3 text-gray-900"
                          type="date"
                          value={endDate}
                          onChange={(e) => setEndDate(e.target.value)}
                        />
                        <button
                          onClick={quote}
                          className="rounded-xl bg-blue-600 hover:bg-blue-700 px-5 py-3 font-semibold"
                        >
                          Cotizar
                        </button>
                      </div>
                      {msg ? <div className="mt-2 text-sm text-yellow-100">{msg}</div> : null}
                    </div>
                  </div>
                </div>
              </div>
            </section>

            {/* Fleet */}
            <section id="vehiculos" className="py-14">
              <div className="max-w-7xl mx-auto px-4">
                <h2 className="text-2xl md:text-3xl font-bold text-center">Nuestra Flota</h2>
                <p className="text-center text-gray-600 mt-2">Kia Picanto desde $35/d칤a 췅 Kia Sonet 2024 desde $60/d칤a</p>
                <div className="mt-8 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                  {carsData.map((car) => (
                    <CarCard key={car.id} car={car} startDate={startDate} endDate={endDate} />
                  ))}
                </div>
              </div>
            </section>

            {/* Benefits */}
            <section id="beneficios" className="py-14 bg-white">
              <div className="max-w-7xl mx-auto px-4">
                <h2 className="text-2xl md:text-3xl font-bold text-center">쯇or qu칠 elegirnos?</h2>
                <div className="mt-8 grid grid-cols-1 md:grid-cols-3 gap-6">
                  <div className="rounded-2xl border p-6">
                    <h3 className="font-semibold">Flota moderna</h3>
                    <p className="text-gray-600 mt-2">Veh칤culos en excelente estado, listos para tu viaje.</p>
                  </div>
                  <div className="rounded-2xl border p-6">
                    <h3 className="font-semibold">Proceso simple</h3>
                    <p className="text-gray-600 mt-2">Cotiza, filtra y reserva en pocos pasos (sin formularios pesados).</p>
                  </div>
                  <div className="rounded-2xl border p-6">
                    <h3 className="font-semibold">Atenci칩n por WhatsApp</h3>
                    <p className="text-gray-600 mt-2">Soporte directo para cerrar tu reserva r치pido.</p>
                  </div>
                </div>
              </div>
            </section>

            {/* Contact */}
            <section id="contacto" className="py-14">
              <div className="max-w-7xl mx-auto px-4">
                <div className="bg-white rounded-3xl shadow p-8 md:p-10">
                  <h2 className="text-2xl md:text-3xl font-bold">Contacto</h2>
                  <p className="text-gray-600 mt-2">쯃isto para tu pr칩xima aventura? Escr칤benos.</p>
                  <div className="mt-4 flex flex-col sm:flex-row gap-3">
                    <a className="rounded-xl border px-4 py-3" href="tel:+50762969414">游 62969414</a>
                    <a className="rounded-xl border px-4 py-3" href="tel:+50764744304">游 64744304</a>
                    <a
                      className="rounded-xl bg-green-500 hover:bg-green-600 text-white px-4 py-3 font-semibold"
                      href="https://wa.me/50762969414?text=Hola%20quiero%20reservar%20un%20veh%C3%ADculo"
                      target="_blank"
                      rel="noopener noreferrer"
                    >
                      WhatsApp
                    </a>
                  </div>
                </div>
              </div>
            </section>

            <footer className="py-8 text-center text-sm text-gray-500">
              춸 2025 Gamboa Rental Cars. Todos los derechos reservados.
            </footer>

            {/* WhatsApp flotante */}
            <a
              href="https://wa.me/50762969414?text=Hola%20quiero%20reservar%20un%20veh%C3%ADculo"
              target="_blank"
              rel="noopener noreferrer"
              className="fixed right-4 bottom-4 z-40 bg-green-500 hover:bg-green-600 text-white rounded-full px-4 py-3 shadow-lg font-semibold"
            >
              쯅ecesitas ayuda?
            </a>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>
